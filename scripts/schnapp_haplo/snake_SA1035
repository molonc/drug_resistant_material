rule combine_hmmcopy_reads:
    """
    merge all data segment data together, change input filename to correct name
    """
    params:
        library_ids = ",".join(list(library.keys())),
        input_dir = os.path.join(config['download_dir']),
        sample = ",".join(list(config['library'][library_id]['sample'] for library_id in library.keys()))
    input:
        expand(os.path.join(config['download_dir'], '{library}','hmmcopy','{library}_reads.csv'), library=library)
    output:
        os.path.join(config['results_pseudobk_dir'], 'ascn_SA1035', 'raw_cnbins.rds')
    shell:
        'Rscript {SOURCE_DIR}/load_hmmcopy_reads.R -l {params.library_ids} -i {params.input_dir} -s {params.sample} -o {output}'
        

rule combine_allele_counts:
    """
    merge all data segment data together, change input filename to correct name
    """
    params:
        library_ids = ",".join(list(library.keys())),
        input_dir = os.path.join(config['download_dir'],'pseudobulk'),
        lib_ticket_fn = os.path.join(config['download_dir'],'pseudobulk', 'SA1035_total_tickets.csv'),
        sample = ",".join(list(config['library'][library_id]['sample'] for library_id in library.keys()))
    input:
        expand(os.path.join(config['download_dir'], '{library}','hmmcopy','{library}_reads.csv'), library=library)
    output:
        os.path.join(config['results_pseudobk_dir'], 'ascn_SA1035', 'raw_allele_data.rds')
    shell:
        'Rscript {SOURCE_DIR}/load_allele_counts.R -l {params.library_ids} -i {params.input_dir} -s {params.sample} -o {output} -t {params.lib_ticket_fn}'
    